(function (window) {
    "use strict";
    var site = window.$ite = {
        window: window,
        doc: window.document,
        body: window.document.body,
        params: {debug: false, trusted: false, sid: 0, vid: 0, aid: 0, lang: "en", domain: ""},
        utils: {
            onLoad: function (callback) {
                document.addEventListener("DOMContentLoaded", callback)
            }, loadScript: function (src, options) {
                options = options || {};
                if (!src) {
                    return
                }
                var script = document.createElement('script');
                script.src = src;
                script.type = 'text/javascript';
                script.async = true;
                script.defer = true;
                document.head.appendChild(script);
                if (options["onload"]) {
                    script.onload = options["onload"]
                }
                site.debug("Load script " + src)
            }, addEvent: function (elem, evType, fn) {
                if (elem.addEventListener) {
                    elem.addEventListener(evType, fn, false)
                } else if (elem.attachEvent) {
                    elem.attachEvent('on' + evType, fn)
                }
            }
        },
        start: function (params) {
            this.params = params;
            if (!!site.window["site_debug"] || window.document.location.search.indexOf("profiling=") !== -1) {
                this.params["debug"] = true
            }
            site.debug("Init site");
            for (var k in site) {
                if (typeof site[k] === "object" && site[k]["start"] && typeof site[k]["start"] === "function") {
                    try {
                        site[k].start.call(site[k])
                    } catch (e) {
                        site.error("Site start error:", e)
                    }
                }
            }
        },
        hasParam: function (name) {
            return !!this.params[name]
        },
        getParam: function (name) {
            return this.params[name] || null
        },
        debug: function () {
            if (!!this.params["debug"]) {
                var args = Array.from(arguments);
                args.unshift("<<DEBUG>>");
                window.console.log.apply(site.window, args)
            }
        },
        error: function () {
            var args = Array.from(arguments);
            args.unshift("<<ERROR>>");
            window.console.error.apply(site.window, args)
        }
    }
})(window);
(function (site) {
    "use strict";
    var STATUS_NOT_LOADED = 0;
    var STATUS_LOADING = 1;
    var STATUS_LOADED = 2;
    var captcha = site.captcha = {
        STATUS_NOT_LOADED: STATUS_NOT_LOADED,
        STATUS_LOADING: STATUS_LOADING,
        STATUS_LOADED: STATUS_LOADED,
        scripts: {
            recaptcha: "https://www.google.com/recaptcha/api.js?onload=onReCaptchaLoad&render=explicit",
            mcaptcha: "//captcha.megagroup.ru/static/captcha.js?3.2"
        },
        status: {recaptcha: 0, mcaptcha: 0},
        queue: {recaptcha: [], mcaptcha: []},
        onMCaptchaLoad: function () {
            captcha.status.mcaptcha = STATUS_LOADED;
            site.debug("MCaptcha loaded");
            captcha.queue.mcaptcha.forEach(function (info) {
                captcha.addMCaptcha(info)
            });
            captcha.queue.mcaptcha = []
        },
        addReCaptcha: function (info) {
            if (captcha.status.recaptcha === STATUS_LOADED) {
                try {
                    site.debug("Draw recaptcha in container", info.container);
                    var $container = $(info.container);
                    $container.empty();
                    grecaptcha.render(info.container, {
                        sitekey: info.key,
                        type: info.type,
                        size: info.rsize,
                        theme: info.theme
                    })
                } catch (e) {
                    site.error("ReCaptcha error: ", e);
                    site.debug("Init mcaptcha by error for container ", info.container);
                    captcha.addMCaptcha(info)
                }
            } else {
                if (captcha.status.recaptcha === STATUS_NOT_LOADED) {
                    site.utils.loadScript(captcha.scripts.recaptcha + "&hl=" + site.getParam("lang"));
                    captcha.status.recaptcha = STATUS_LOADING
                }
                captcha.queue.recaptcha.push(info)
            }
        },
        addMCaptcha: function (info) {
            if (captcha.status.mcaptcha === STATUS_LOADED) {
                var $container = $(info.container);
                var rand_id = Math.floor(Math.random() * 10000);
                var container_id = 's3_captcha_cn' + rand_id;
                var html = '</br><input type="text" name="' + info.name + '" maxlength="' + info.msize + '" size="' + info.msize + '" />';
                $container.attr('id', container_id);
                try {
                    site.debug("Draw mcaptcha in container", info.container);
                    mgCaptcha.draw("/my/s3/captcha/get.php", container_id);
                    $container.append(html)
                } catch (e) {
                    site.error("MCaptcha error:", e)
                }
            } else {
                if (captcha.status.mcaptcha === STATUS_NOT_LOADED) {
                    site.utils.loadScript(captcha.scripts.mcaptcha, {
                        onload: function () {
                            captcha.onMCaptchaLoad()
                        }
                    });
                    captcha.status.mcaptcha = STATUS_LOADING
                }
                captcha.queue.mcaptcha.push(info)
            }
        },
        checker: function () {
            $("[data-captcha]").each(function (k, container) {
                var $container = $(container);
                if ($container.attr("data-captcha") === "recaptcha") {
                    site.debug("Init recaptcha by default for ", $container);
                    captcha.addReCaptcha({
                        key: $container.attr("data-sitekey"),
                        type: $container.attr("data-type"),
                        rsize: $container.attr("data-rsize"),
                        msize: $container.attr("data-msize"),
                        theme: $container.attr("data-theme"),
                        lang: $container.attr("data-lang"),
                        name: $container.attr("data-name"),
                        container: container
                    })
                } else {
                    site.debug("Init mcaptcha by default for ", $container);
                    captcha.addMCaptcha({
                        name: $container.attr("data-name"),
                        msize: $container.attr("data-msize"),
                        container: container
                    })
                }
                $container.removeAttr("data-captcha")
            })
        },
        start: function () {
            if (!!site.window["$"]) {
                setInterval(function () {
                    try {
                        captcha.checker()
                    } catch (e) {
                        site.error("Captcha checker:", e)
                    }
                }, 300)
            }
        }
    };
    site.window.onReCaptchaLoad = function () {
        captcha.status.recaptcha = STATUS_LOADED;
        site.debug("Recaptcha loaded");
        captcha.queue.recaptcha.forEach(function (info) {
            captcha.addReCaptcha(info)
        });
        site.captcha.queue.recaptcha = []
    }
})(window.$ite);
(function (site) {
    "use strict";
    site.hotkeys = {
        start: function () {
            if (site.getParam("trusted")) {
                site.utils.addEvent(window.document, "keydown", function (e) {
                    if (e['altKey'] && e.keyCode === 80) {
                        if (location.search.indexOf("profiling") === -1) {
                            if (location.search.indexOf("?") === -1) {
                                location.search += "?profiling=" + Math.round(Math.random() * 100000)
                            } else {
                                location.search += "&profiling=" + Math.round(Math.random() * 100000)
                            }
                        }
                    }
                    if (e['altKey'] && e.keyCode === 79 && site.hasParam("domain") && site.hasParam("vid") && site.hasParam("aid")) {
                        site.window.open(window.atob("aHR0cDovLw==") + site.getParam("domain") + window.atob("L215L3MzL2RhdGEvbWVudS9kZWZhdWx0LnBocD9tY2E9") + site.getParam("aid") + window.atob("Jm1jcz0xJnZlcl9pZD0=") + site.getParam("vid"))
                    }
                })
            }
        }
    }
})(window.$ite);
(function (site) {
    "use strict";
    var feedback = site.feedback = {
        factory: null, start: function () {
            site.utils.loadScript("/shared/feedback/feedback.factory.js", {
                onload: function () {
                    feedback.factory = site.window.FeedbackFactory;
                    site.feedback.factoryStart()
                }
            })
        }, factoryStart: function () {
            feedback.factory.setOption('sources', '/shared/feedback');
            feedback.factory.setOption('url', site.window.atob('L215L3MzL2ZlZWRiYWNrL3JlcG9ydC5waHA='));
            feedback.factory.setData('instance_id', site.getParam('aid'));
            feedback.factory.addScript(site.window.atob("aHR0cHM6Ly9jYWJpbmV0Lm1lZ2Fncm91cC5ydS9jbGllbnQuanNvbnA/Y2FsbGJhY2s9") + "setFeedbackUserId")
        }
    };
    site.window.setFeedbackUserId = function (data) {
        if (data.id) {
            feedback.factory.setData('user_id', data.id)
        }
    }
})(window.$ite);